
> server@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (14) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[INFO] Server running on http://localhost:3001 {}
[INFO] ‚úÖ Connexion √† MySQL √©tablie avec succ√®s {}
[INFO] ‚úÖ Table RefreshTokens synchronis√©e {}
[INFO] ‚úÖ Base de donn√©es synchronis√©e avec succ√®s {}
[WARN] Expired token attempt { ip: '::1' }
[WARN] Expired token attempt { ip: '::1' }
[INFO] Access token refreshed { userId: 17 }
[AI Coach Route] Requ√™te re√ßue: { userId: 17, message: 'bonjour...' }
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: { action: 'sendMessage', sessionId: '17', chatInput: 'bonjour' }
}
[AI Coach] Statut de la r√©ponse: 200 OK
[AI Coach] R√©ponse compl√®te du webhook: {
  "output": "Bonjour ! Comment puis-je vous aider aujourd'hui ? Que ce soit pour des conseils en nutrition, un plan d'entra√Ænement, ou toute autre question, je suis l√† pour vous soutenir !"
}
[AI Coach] R√©ponse de l'AI extraite: Bonjour ! Comment puis-je vous aider aujourd'hui ? Que ce soit pour des conseils en nutrition, un pl...
[AI Coach Route] R√©sultat du service: { success: true, hasMessage: true, messageLength: 175 }
[WARN] Expired token attempt { ip: '::1' }
[INFO] Access token refreshed { userId: 17 }
[WARN] Expired token attempt { ip: '::1' }
[WARN] Expired token attempt { ip: '::1' }
[INFO] Access token refreshed { userId: 17 }
[AI Coach Route] Requ√™te re√ßue: {
  userId: 17,
  message: 'aps tu acces a mes infos, si oui cite les moi...'
}
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: {
    action: 'sendMessage',
    sessionId: '17',
    chatInput: 'aps tu acces a mes infos, si oui cite les moi'
  }
}
[AI Coach] Statut de la r√©ponse: 500 Internal Server Error
[AI Coach] Erreur HTTP: {"message":"Error in workflow"}
[AI Coach] Erreur lors de la communication avec l'AI Coach: Error: Error in workflow
    at sendMessageToAICoach (/Users/williampeynichou/projetAppliSport/server/services/aiCoachService.js:53:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/williampeynichou/projetAppliSport/server/routes/aiCoach.js:26:20
[AI Coach Route] R√©sultat du service: { success: false, hasMessage: false, messageLength: undefined }
[AI Coach Route] Erreur du service: Error in workflow
[AI Coach Route] Requ√™te re√ßue: { userId: 17, message: 'bonjour...' }
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: { action: 'sendMessage', sessionId: '17', chatInput: 'bonjour' }
}
[AI Coach] Statut de la r√©ponse: 200 OK
[AI Coach] R√©ponse compl√®te du webhook: {
  "output": "Bonjour encore ! üòä Comment se passe votre journ√©e ? Avez-vous des questions ou des objectifs sportifs en t√™te ? Je suis l√† pour vous aider !"
}
[AI Coach] R√©ponse de l'AI extraite: Bonjour encore ! üòä Comment se passe votre journ√©e ? Avez-vous des questions ou des objectifs sporti...
[AI Coach Route] R√©sultat du service: { success: true, hasMessage: true, messageLength: 141 }
[AI Coach Route] Requ√™te re√ßue: {
  userId: 17,
  message: 'as tu acces a mes donn√©e ? poid, taille, objectif,...'
}
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: {
    action: 'sendMessage',
    sessionId: '17',
    chatInput: 'as tu acces a mes donn√©e ? poid, taille, objectif, imc ?'
  }
}
[AI Coach] Statut de la r√©ponse: 200 OK
[AI Coach] R√©ponse compl√®te du webhook: {
  "output": "Je n'ai pas acc√®s √† vos donn√©es personnelles pour le moment. Cependant, si vous me fournissez vos informations telles que votre poids, votre taille, votre objectif et √©ventuellement votre IMC, je pourrai vous aider √† cr√©er un plan d'entra√Ænement ou des conseils nutritionnels adapt√©s √† vos besoins. N'h√©sitez pas √† partager ce que vous souhaitez !"
}
[AI Coach] R√©ponse de l'AI extraite: Je n'ai pas acc√®s √† vos donn√©es personnelles pour le moment. Cependant, si vous me fournissez vos in...
[AI Coach Route] R√©sultat du service: { success: true, hasMessage: true, messageLength: 347 }
[WARN] Expired token attempt { ip: '::1' }
[WARN] Expired token attempt { ip: '::1' }
[INFO] Access token refreshed { userId: 17 }
[WARN] Expired token attempt { ip: '::1' }
[WARN] Expired token attempt { ip: '::1' }
[INFO] Access token refreshed { userId: 17 }
[AI Coach Route] Requ√™te re√ßue: {
  userId: 17,
  message: 'cite moi tu ce que tu sais par rapport a moi et a ...'
}
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: {
    action: 'sendMessage',
    sessionId: '17',
    chatInput: 'cite moi tu ce que tu sais par rapport a moi et a mes infos en bdd'
  }
}
[AI Coach] Statut de la r√©ponse: 500 Internal Server Error
[AI Coach] Erreur HTTP: {"message":"Error in workflow"}
[AI Coach] Erreur lors de la communication avec l'AI Coach: Error: Error in workflow
    at sendMessageToAICoach (/Users/williampeynichou/projetAppliSport/server/services/aiCoachService.js:53:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/williampeynichou/projetAppliSport/server/routes/aiCoach.js:26:20
[AI Coach Route] R√©sultat du service: { success: false, hasMessage: false, messageLength: undefined }
[AI Coach Route] Erreur du service: Error in workflow
[WARN] Expired token attempt { ip: '::1' }
[INFO] Access token refreshed { userId: 17 }
[AI Coach Route] Requ√™te re√ßue: { userId: 17, message: 'bonjour...' }
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: { action: 'sendMessage', sessionId: '17', chatInput: 'bonjour' }
}
[AI Coach] Statut de la r√©ponse: 200 OK
[AI Coach] R√©ponse compl√®te du webhook: {
  "output": "Bonjour ! üòÑ Comment puis-je vous aider aujourd'hui ? Si vous avez des questions ou des objectifs sportifs en t√™te, n'h√©sitez pas √† les partager !"
}
[AI Coach] R√©ponse de l'AI extraite: Bonjour ! üòÑ Comment puis-je vous aider aujourd'hui ? Si vous avez des questions ou des objectifs sp...
[AI Coach Route] R√©sultat du service: { success: true, hasMessage: true, messageLength: 146 }
[AI Coach Route] Requ√™te re√ßue: { userId: 17, message: 'as tu acces a mes infos ?...' }
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: {
    action: 'sendMessage',
    sessionId: '17',
    chatInput: 'as tu acces a mes infos ?'
  }
}
[AI Coach] Statut de la r√©ponse: 200 OK
[AI Coach] R√©ponse compl√®te du webhook: {
  "output": "Oui, je peux acc√©der √† vos informations si elles sont enregistr√©es dans la base de donn√©es. Cela me permettra de vous donner des conseils personnalis√©s en fonction de votre poids, taille, objectif, IMC, etc.\n\nSi vous le souhaitez, je peux v√©rifier vos donn√©es. Souhaitez-vous que je le fasse ?"
}
[AI Coach] R√©ponse de l'AI extraite: Oui, je peux acc√©der √† vos informations si elles sont enregistr√©es dans la base de donn√©es. Cela me ...
[AI Coach Route] R√©sultat du service: { success: true, hasMessage: true, messageLength: 293 }
[AI Coach Route] Requ√™te re√ßue: { userId: 17, message: 'oui...' }
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: { action: 'sendMessage', sessionId: '17', chatInput: 'oui' }
}
[AI Coach] Statut de la r√©ponse: 200 OK
[AI Coach] R√©ponse compl√®te du webhook: {
  "output": "Voici les informations que j'ai trouv√©es :\n\n- **√Çge** : 27 ans\n- **Taille** : 185 cm\n- **Poids cible** : 85 kg\n- **Consommation calorique** : 2290 kcal par jour\n- **Semaines restantes pour atteindre l'objectif** : 22 semaines\n- **Pseudo** : wili\n\nCependant, votre IMC n'est pas sp√©cifi√© dans la base de donn√©es. Si vous avez besoin d'aide pour votre entra√Ænement ou votre nutrition, faites-le moi savoir ! Je peux vous proposer un plan ou des conseils adapt√©s √† vos objectifs. üòä"
}
[AI Coach] R√©ponse de l'AI extraite: Voici les informations que j'ai trouv√©es :

- **√Çge** : 27 ans
- **Taille** : 185 cm
- **Poids cible...
[AI Coach Route] R√©sultat du service: { success: true, hasMessage: true, messageLength: 479 }
[WARN] Failed login attempt {
  email: 'WILLIAMPEYNICHOU@GMAIL.COM',
  ip: '::1',
  userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36',
  userExists: true
}
[INFO] User logged in { userId: 1, email: 'WILLIAMPEYNICHOU@GMAIL.COM', ip: '::1' }
[INFO] Strava token refreshed successfully { userId: 1 }
[WARN] Expired token attempt { ip: '::1' }
[WARN] Expired token attempt { ip: '::1' }
[INFO] Access token refreshed { userId: 1 }
[INFO] User logged in { userId: 1, email: 'WILLIAMPEYNICHOU@GMAIL.COM', ip: '::1' }
[AI Coach Route] Requ√™te re√ßue: { userId: 1, message: 'quels sont mes infos...' }
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: {
    action: 'sendMessage',
    sessionId: '1',
    chatInput: 'quels sont mes infos'
  }
}
[AI Coach] Statut de la r√©ponse: 200 OK
[AI Coach] R√©ponse compl√®te du webhook: {
  "output": "Voici vos informations :\n\n- **Email** : WILLIAMPEYNICHOU@GMAIL.COM\n- **Pseudo** : wili\n- **√Çge** : 27 ans\n- **Taille** : 185 cm\n- **Sexe** : Masculin\n- **Poids cible** : 85 kg\n- **Consommation calorique quotidienne** : 2290 Kcal\n- **Temps estim√© pour atteindre l'objectif (semaines)** : 22 semaines\n- **Pays** : France\n\nSi vous avez besoin d'aide pour atteindre votre objectif de poids ou pour √©tablir un plan d'entra√Ænement, n'h√©sitez pas √† me le faire savoir ! Je suis l√† pour vous accompagner. üòä"
}
[AI Coach] R√©ponse de l'AI extraite: Voici vos informations :

- **Email** : WILLIAMPEYNICHOU@GMAIL.COM
- **Pseudo** : wili
- **√Çge** : 2...
[AI Coach Route] R√©sultat du service: { success: true, hasMessage: true, messageLength: 499 }
[INFO] User logged out { userId: 1 }
[WARN] Failed login attempt {
  email: 'test@test.com',
  ip: '::1',
  userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36',
  userExists: true
}
[WARN] Failed login attempt {
  email: 'test@test.com',
  ip: '::1',
  userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36',
  userExists: true
}
[INFO] User logged in { userId: 10, email: 'testStrava@testStrava.com', ip: '::1' }
[INFO] Generating Strava OAuth URL { userId: 10, state: '10_1764250510648_385h8' }
[INFO] Strava OAuth callback received { hasCode: true, hasState: true }
[AI Coach Route] Requ√™te re√ßue: { userId: 10, message: 'donne moi mes infos...' }
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: {
    action: 'sendMessage',
    sessionId: '10',
    chatInput: 'donne moi mes infos'
  }
}
[AI Coach] Statut de la r√©ponse: 200 OK
[AI Coach] R√©ponse compl√®te du webhook: {
  "output": "Il semble que je ne puisse pas acc√©der √† vos informations pour le moment. Pour vous aider au mieux, pourriez-vous me donner votre adresse e-mail ou d'autres informations qui pourraient m'aider √† vous identifier ?"
}
[AI Coach] R√©ponse de l'AI extraite: Il semble que je ne puisse pas acc√©der √† vos informations pour le moment. Pour vous aider au mieux, ...
[AI Coach Route] R√©sultat du service: { success: true, hasMessage: true, messageLength: 212 }
[AI Coach Route] Requ√™te re√ßue: { userId: 10, message: 'Strava...' }
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: { action: 'sendMessage', sessionId: '10', chatInput: 'Strava' }
}
[AI Coach] Statut de la r√©ponse: 200 OK
[AI Coach] R√©ponse compl√®te du webhook: {
  "output": "Pour acc√©der √† vos informations, j‚Äôai besoin d‚Äôun peu plus de pr√©cisions, comme par exemple votre adresse e-mail ou un autre identifiant que vous pourriez avoir utilis√©. Cela m'aidera √† trouver vos donn√©es dans notre base de donn√©es. Pourriez-vous me fournir cela ?"
}
[AI Coach] R√©ponse de l'AI extraite: Pour acc√©der √† vos informations, j‚Äôai besoin d‚Äôun peu plus de pr√©cisions, comme par exemple votre ad...
[AI Coach Route] R√©sultat du service: { success: true, hasMessage: true, messageLength: 265 }
[WARN] Expired token attempt { ip: '::1' }
[WARN] Expired token attempt { ip: '::1' }
[INFO] Access token refreshed { userId: 10 }
[AI Coach Route] Requ√™te re√ßue: {
  userId: 10,
  message: 'fais moi un programme pour la semaine prochaine de...'
}
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: {
    action: 'sendMessage',
    sessionId: '10',
    chatInput: 'fais moi un programme pour la semaine prochaine de velo pour un entrainement de perte de poid optimis√©'
  }
}
[AI Coach] Statut de la r√©ponse: 500 Internal Server Error
[AI Coach] Erreur HTTP: {"message":"Error in workflow"}
[AI Coach] Erreur lors de la communication avec l'AI Coach: Error: Error in workflow
    at sendMessageToAICoach (/Users/williampeynichou/projetAppliSport/server/services/aiCoachService.js:53:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/williampeynichou/projetAppliSport/server/routes/aiCoach.js:26:20
[AI Coach Route] R√©sultat du service: { success: false, hasMessage: false, messageLength: undefined }
[AI Coach Route] Erreur du service: Error in workflow
[AI Coach Route] Requ√™te re√ßue: {
  userId: 10,
  message: 'fais moi un programme pour la semaine prochaine de...'
}
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: {
    action: 'sendMessage',
    sessionId: '10',
    chatInput: 'fais moi un programme pour la semaine prochaine de velo pour un entrainement de perte de poid optimis√©'
  }
}
[AI Coach] Statut de la r√©ponse: 500 Internal Server Error
[AI Coach] Erreur HTTP: {"message":"Error in workflow"}
[AI Coach] Erreur lors de la communication avec l'AI Coach: Error: Error in workflow
    at sendMessageToAICoach (/Users/williampeynichou/projetAppliSport/server/services/aiCoachService.js:53:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/williampeynichou/projetAppliSport/server/routes/aiCoach.js:26:20
[AI Coach Route] R√©sultat du service: { success: false, hasMessage: false, messageLength: undefined }
[AI Coach Route] Erreur du service: Error in workflow
[WARN] Expired token attempt { ip: '::1' }
[WARN] Expired token attempt { ip: '::1' }
[INFO] Access token refreshed { userId: 1 }
[AI Coach Route] Requ√™te re√ßue: { userId: 10, message: 'tu marche toi ?...' }
[AI Coach] Envoi de la requ√™te au webhook n8n: {
  url: 'https://williampeynichou.app.n8n.cloud/webhook/34393d88-7535-40f2-a32b-8b12196ffc55/chat',
  body: {
    action: 'sendMessage',
    sessionId: '10',
    chatInput: 'tu marche toi ?'
  }
}
[AI Coach] Statut de la r√©ponse: 500 Internal Server Error
[AI Coach] Erreur HTTP: {"message":"Error in workflow"}
[AI Coach] Erreur lors de la communication avec l'AI Coach: Error: Error in workflow
    at sendMessageToAICoach (/Users/williampeynichou/projetAppliSport/server/services/aiCoachService.js:53:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async /Users/williampeynichou/projetAppliSport/server/routes/aiCoach.js:26:20
[AI Coach Route] R√©sultat du service: { success: false, hasMessage: false, messageLength: undefined }
[AI Coach Route] Erreur du service: Error in workflow
[INFO] User logged out { userId: 10 }
[INFO] User logged in { userId: 1, email: 'WILLIAMPEYNICHOU@GMAIL.COM', ip: '::1' }
